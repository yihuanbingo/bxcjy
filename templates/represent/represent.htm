{include file='represent/library/page_header.htm'}
<script type="text/javascript" src="/templates/js/DatePicker.js"></script>

	<div class="col_main">
	  <div class="main_hd">
	    <div class="title_tab">
		  <ul class="tab_navs"> 
		    <li {if $act==default}class="selected"{/if}><a href="/represent/represent">缴费查询</a></li>
			<li {if $act==bind}class="selected"{/if}><a href="/represent/represent?act=bind">上传缴费资料</a></li>
		  </ul>
		</div>
	  </div>
	
<div class="main_content">	 
 {if $act==default}
 <!-- 缴费查询--> 
 <!-- 绑定数据用于post -->
<div class="form_search fontSize12">
<form action="/represent/represent" method="get" enctype="multipart/form-data" name="search">
 至 <input type="text" name="pay_late" id="pay_late" onClick="setmonth(this, 'yyyy-MM', '2013-01', '2024-12', 1)" readonly style="width:110px" value="{$pay_late}">
  月&ensp;&ensp;
 <select name="status" style="padding:0">
  <option value="-1">缴费状态</option>
  <option value="0" {if $status==0}selected{/if}>欠费</option>
  <option value="1" {if $status==1}selected{/if}>正常</option>
 </select>&ensp;&ensp;
 房号/业主姓名/手机号
 <input type="text" name="keywords" value="{$keywords}">&ensp;
 <input type="hidden" name="page" value="1">
 <input type="submit" class="searchbutton" value="搜 索"> 
</form>
</div>
<div class="clear height10"></div>
 <form action="/represent/ajax.php" method="post" enctype="multipart/form-data" id="represent">
 <table class="info_list" cellspacing="1">
  <tr>
   <th width="30px"></th>
   <th width="80px">房号</th>
   <th width="120px">每月应缴</th>
   <th width="150px">已交至</th>
   <th width="100px">当前状态</th>
   <th width="150px">费用状态</th>
   <th>操作</th>
  </tr>
  {foreach from=$log.res item=l}
   <tr>
     <td><input type="checkbox" name="log_id[]" value="{$l.log_id}"></td>
     <td align="center">{$l.house_number}</td>
	 <td align="center"> 
	  <span id="pay_month_text_{$l.log_id}">¥ {$l.pay_month}</span>
	  <span id="pay_month_input_{$l.log_id}" style="display:none">
	    ¥ <input type="text" value="{$l.pay_month}" class="editinput" id="pay_month_{$l.log_id}">
	  </span>
	 </td>
	 <td align="center">
	   <span id="pay_late_text_{$l.log_id}">{$l.pay_late}</span>
	   <span id="pay_late_input_{$l.log_id}" style="display:none">
	     <input type="text" value="{$l.pay_late}" class="editinput" id="pay_late_{$l.log_id}" onClick="setmonth(this, 'yyyy-MM', '2013-01', '2024-12', 1)" readonly style="width:110px">
	   </span>
	 </td>
	 <td align="center" class="red">
	   <span id="status_{$l.log_id}">{if $l.status==1}<img src="/templates/images/icon/yes.gif">{else}已欠费{/if}</span>
	 </td>
	 <td align="center" class="red">
	   <span id="arreage_{$l.log_id}">{if $l.arrearage}- ¥ {$l.arrearage}{else}<img src="/templates/images/icon/yes.gif">{/if}</span>
	 </td>
	 <td align="center">
	  <div id="edit_view_{$l.log_id}"> 
	   <a href="javascript:void(0);" onclick="javascript:viewUpdaterepresent({$l.log_id});">
	     <img src="/templates/images/icon/icon_edit.gif" title="编辑">
	   </a>&ensp;
	   <a href="javascript:void(0);" onclick="javascript:deleterepresent({$l.log_id});">
	     <img src="/templates/images/icon/icon_trash.gif" title="删除">
	   </a>
	  </div>
      <div id="edit_act_{$l.log_id}" style="display:none">
	    <input type="button" class="searchbutton" onclick="javascript:doUpdaterepresent({$l.log_id});" value="确 认">
		<input type="button" class="searchbutton" onclick="javascript:cancelUpdaterepresent({$l.log_id});" value="取 消">
	  </div>
	 </td>
   </tr>
  {/foreach}
  <tr height="35px">
    <td colspan="2">
	 <label><input type="checkbox" onclick="javascript:selectAll(this,'log_id[]');"> 全选</label>
	</td>
	<td colspan="5">
	 <select name="act" style="padding:0">
	  <option>请选择操作</option>
	  <option value="deleteLog">删除</option>
	 </select>
	 &ensp;
	 <input type="hidden" name="logType" value="log_represent">
	 <input type="button" class="searchbutton" onclick="javascript:AjaxSubmit('represent');" value="确  定">
	</td>
  </tr>
  </table>
  </form>
  <div class="clear height10"></div>
  <div class="float_r">
   {include file="represent/library/page.htm"}
  </div>
  <div class="clear"></div>
  <script type="text/javascript">
  /* 定义编辑操作类 */
  function Updaterepresent(id)
  {
     this.edit_view = document.getElementById("edit_view_"+id);
	 this.edit_act = document.getElementById("edit_act_"+id);
	 this. pay_month_text = document.getElementById("pay_month_text_"+id);
	 this.pay_late_text = document.getElementById("pay_late_text_"+id);
	 this.pay_month_input = document.getElementById("pay_month_input_"+id);
	 this.pay_late_input = document.getElementById("pay_late_input_"+id);
	 this.pay_month = document.getElementById("pay_month_"+id);
	 this.pay_late = document.getElementById("pay_late_"+id);
	 /* 显示编辑框、按钮 */
	 this.viewUpdaterepresent = function() {
	   this.edit_view.style.display="none";
	   this.edit_act.style.display="block"; 
	   this.pay_month_text.style.display="none";
	   this.pay_month_input.style.display="block";
	   this.pay_late_text.style.display="none";
	   this.pay_late_input.style.display="block";
	 }
	 /* 取消编辑 */
	 this.cancelUpdaterepresent = function() { 
	   this.edit_view.style.display="block";
	   this.edit_act.style.display="none"; 
	   this.pay_month_text.style.display="block";
	   this.pay_month_input.style.display="none";
	   this.pay_late_text.style.display="block";
	   this.pay_late_input.style.display="none";
	 }
	 /* 提交编辑 */
	 this.doUpdaterepresent = function() {
	   $.post("/represent/represent", {
	                      act:'update', log_id: id, pay_month: this.pay_month.value, pay_late: this.pay_late.value},
       function(data)
       {
	    var data = json_decode(data);
	    if(data.error==0)
	    {
		  alertMsg(data.data);
		  setTimeout("window.location.reload();",1000);
	    }
	    if(data.error==1)
	    {
	      /* 弹出错误提示 */
		  alertMsg(data.data);
	    }
       });	
	 }
	 /* 删除单条信息 */
	 this.deleterepresent = function() { 
	   $.post("/represent/ajax.php", {
	                      act:'deleteLog', log_id: [id], logType: 'log_represent' },
       function(data)
       {
	    var data = json_decode(data);
	    if(data.error==0)
	    {
		  alertMsg(data.data);
		  setTimeout("window.location.reload();",1000);
	    }
	    if(data.error==1)
	    {
	      /* 弹出错误提示 */
		  alertMsg(data.data);
	    }
       });	 
	 }
  }
  /* 显示编辑框、按钮 */
  function viewUpdaterepresent(id)
  {
     var updateproprety = new Updaterepresent(id);
	 updateproprety.viewUpdaterepresent();
  }
  /* 取消编辑 */
  function cancelUpdaterepresent(id)
  {
     var updateproprety = new Updaterepresent(id);
	 updateproprety.cancelUpdaterepresent();
  }
  /* 提交编辑 */
  function doUpdaterepresent(id)
  {
     var updateproprety = new Updaterepresent(id);
	 updateproprety.doUpdaterepresent(); 
  }
  /* 删除单条记录 */
  function deleterepresent(id)
  { 
     var updateproprety = new Updaterepresent(id);
	 updateproprety.deleterepresent(); 
  }
  </script>
 {/if}
 {if $act==bind}
 <link rel="stylesheet" href="/includes/kindeditor/themes/default/default.css">
 <script type="text/javascript" src="/includes/kindeditor/kindeditor-min.js"></script>
 <script type="text/javascript" src="/includes/kindeditor/lang/zh_CN.js"></script> 
 <script type="text/javascript">
			KindEditor.ready(function(K) {
				var editor = K.editor({
					allowFileManager : false,
					uploadJson : '/represent/represent?act=act_bind'
				});
				K('#insertfile').click(function() {
					editor.loadPlugin('image', function() {
						editor.plugin.imageDialog({
							showRemote : false,
							clickFn : function(url, title, width, height, border, align) 
							{
							    window.location.href = url;
							}
						});
					});
				});
			});
 </script>
 <input type="button" class="btn_primary"  id="insertfile" value="上传excel文件"> 
 &ensp; <a href="/data/excel/wuyefei.rar"><span class="red" style="text-decoration:underline">下载物业费示例表格</span></a>
 {/if}
</div>

</div>